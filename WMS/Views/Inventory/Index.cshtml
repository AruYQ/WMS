@model WMS.Models.ViewModels.InventoryIndexViewModel
@{
    ViewData["Title"] = "Inventory Management";
}

<div class="page-header">
    <div class="row align-items-center">
        <div class="col">
            <h1 class="page-title">
                <i class="fas fa-boxes me-2"></i>
                Inventory Management
            </h1>
            <p class="page-subtitle">Manage warehouse inventory, stock levels, and locations</p>
        </div>
        <div class="col-auto">
            <a href="@Url.Action("Create")" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Add Inventory
            </a>
        </div>
    </div>
</div>

<!-- Summary Statistics -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-boxes fa-2x"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h4 class="mb-0">@Model.Summary.TotalItems</h4>
                        <small>Total Items</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h4 class="mb-0">@Model.Summary.AvailableStock</h4>
                        <small>Available Stock</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h4 class="mb-0">@Model.Summary.LowStockCount</h4>
                        <small>Low Stock Items</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-dollar-sign fa-2x"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h4 class="mb-0">@Model.Summary.TotalValue.ToString("C")</h4>
                        <small>Total Value</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Status Filter -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body py-3">
                <div class="d-flex align-items-center">
                    <label class="me-3 mb-0 fw-medium">Filter by Status:</label>
                    <div class="btn-group" role="group">
                        <a href="@Url.Action("Index")" class="btn @(string.IsNullOrEmpty(Model.StatusFilter) ? "btn-primary" : "btn-outline-primary") btn-sm">
                            All (@Model.Inventories.Count())
                        </a>
                        <a href="@Url.Action("Index", new { statusFilter = "Available" })" class="btn @(Model.StatusFilter == "Available" ? "btn-success" : "btn-outline-success") btn-sm">
                            Available (@Model.Inventories.Count(i => i.Status == "Available"))
                        </a>
                        <a href="@Url.Action("Index", new { statusFilter = "Reserved" })" class="btn @(Model.StatusFilter == "Reserved" ? "btn-warning" : "btn-outline-warning") btn-sm">
                            Reserved (@Model.Inventories.Count(i => i.Status == "Reserved"))
                        </a>
                        <a href="@Url.Action("Index", new { statusFilter = "Damaged" })" class="btn @(Model.StatusFilter == "Damaged" ? "btn-danger" : "btn-outline-danger") btn-sm">
                            Damaged (@Model.Inventories.Count(i => i.Status == "Damaged"))
                        </a>
                        <a href="@Url.Action("Index", new { showLowStockOnly = true })" class="btn @(Model.ShowLowStockOnly ? "btn-info" : "btn-outline-info") btn-sm">
                            Low Stock (@Model.Inventories.Count(i => i.NeedsReorder))
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Inventory Table -->
<div class="card">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
                <i class="fas fa-list me-2"></i>
                Inventory List
                @if (!string.IsNullOrEmpty(Model.StatusFilter))
                {
                    <span class="badge bg-primary ms-2">@Model.StatusFilter</span>
                }
            </h5>
            <div class="btn-group" role="group">
                <a href="@Url.Action("Putaway")" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-truck-loading me-1"></i>
                    Putaway
                </a>
                <a href="@Url.Action("LocationStatus")" class="btn btn-outline-info btn-sm">
                    <i class="fas fa-map-marker-alt me-1"></i>
                    Location Status
                </a>
            </div>
        </div>
    </div>
    <div class="card-body p-0">
                @if (Model.Inventories.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Location</th>
                                    <th>Quantity</th>
                                    <th>Status</th>
                                    <th>Value</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var inventory in Model.Inventories)
                                {
                                    <tr>
                                        <td>
                                            <div class="fw-medium text-primary">@inventory.ItemDisplay</div>
                                            @if (!string.IsNullOrEmpty(inventory.SourceReference))
                                            {
                                                <div class="small text-muted">
                                                    <i class="fas fa-tag me-1"></i>
                                                    @inventory.SourceReference
                                                </div>
                                            }
                                        </td>
                                        <td>
                                            <div class="fw-medium">@inventory.LocationDisplay</div>
                                            <div class="small text-muted">
                                                <i class="fas fa-cube me-1"></i>
                                                @inventory.ItemUnit
                                            </div>
                                        </td>
                                        <td>
                                            <div class="fw-medium">@inventory.Quantity</div>
                                            @if (inventory.NeedsReorder)
                                            {
                                                <div class="small text-warning">
                                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                                    Low Stock
                                                </div>
                                            }
                                        </td>
                                        <td>
                                            <span class="@inventory.StatusCssClass">@inventory.StatusIndonesia</span>
                                        </td>
                                        <td>
                                            <div class="fw-medium text-success">@inventory.TotalValue.ToString("C0")</div>
                                            <div class="small text-muted">@inventory.LastCostPrice.ToString("C0")/unit</div>
                                        </td>
                                        <td>
                                            <span class="fw-medium">@inventory.LastUpdated.ToString("dd MMM yyyy")</span>
                                            <div class="small text-muted">@inventory.LastUpdated.ToString("HH:mm")</div>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <a href="@Url.Action("Details", new { id = inventory.Id })"
                                                   class="btn btn-sm btn-outline-primary"
                                                   title="View Details">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <a href="@Url.Action("Edit", new { id = inventory.Id })"
                                                   class="btn btn-sm btn-outline-secondary"
                                                   title="Edit">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="@Url.Action("TransferStock", new { inventoryId = inventory.Id })"
                                                   class="btn btn-sm btn-outline-info"
                                                   title="Transfer Stock">
                                                    <i class="fas fa-exchange-alt"></i>
                                                </a>
                                                <a href="@Url.Action("AdjustStock", new { inventoryId = inventory.Id })"
                                                class="btn btn-sm btn-outline-warning"
                                                title="Adjust Stock">
                                                    <i class="fas fa-adjust"></i>
                                                </a>
                                                <a href="@Url.Action("Delete", new { id = inventory.Id })"
                                                   class="btn btn-sm btn-outline-danger"
                                                   title="Delete">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center py-5">
                        <i class="fas fa-boxes fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No Inventory Found</h5>
                        <p class="text-muted">
                            @if (!string.IsNullOrEmpty(Model.StatusFilter))
                            {
                                @:No inventory with status "@Model.StatusFilter" found.
                            }
                            else
                            {
                                @:Get started by adding your first inventory item.
                            }
                        </p>
                        <a href="@Url.Action("Create")" class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>
                            Add First Inventory
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<script>
    // Auto-refresh for low stock alerts
    setInterval(function() {
        if (!document.hidden && document.querySelector('[href*="showLowStockOnly=true"]')?.classList.contains('btn-info')) {
            location.reload();
        }
    }, 120000);

    // Add tooltips for action buttons
    document.addEventListener('DOMContentLoaded', function() {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
