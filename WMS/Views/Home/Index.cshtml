@model WMS.Models.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="page-header">
    <div class="row align-items-center">
        <div class="col">
            <h1 class="page-title">
                <i class="fas fa-tachometer-alt me-2"></i>
                Dashboard
            </h1>
            <p class="page-subtitle">Warehouse Management System Overview</p>
        </div>
        <div class="col-auto">
            <button type="button" class="btn btn-outline-primary" id="refreshDashboard" onclick="location.reload()">
                <i class="fas fa-sync-alt"></i>
                Refresh
            </button>
        </div>
    </div>
</div>

<!-- Quick Stats Cards -->
<div class="row mb-4">
    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="stats-card">
            <div class="row align-items-center">
                <div class="col">
                    <div class="h2 mb-1">@Model.KPI.TotalPurchaseOrders.ToString("N0")</div>
                    <div class="small">Total Purchase Orders</div>
                    @if (Model.KPI.PendingPurchaseOrders > 0)
                    {
                        <div class="small mt-1">
                            <span class="badge bg-warning">@Model.KPI.PendingPurchaseOrders Pending</span>
                        </div>
                    }
                </div>
                <div class="col-auto">
                    <i class="fas fa-shopping-cart fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="stats-card success">
            <div class="row align-items-center">
                <div class="col">
                    @* <div class="h2 mb-1">@Model.KPI.TotalSalesOrders.ToString("N0")</div> *@
                    @* <div class="small">Total Sales Orders</div> *@
                    @* @if (Model.KPI.PendingSalesOrders > 0) *@
                    @* { *@
                    @*     <div class="small mt-1"> *@
                    @*         <span class="badge bg-warning">@Model.KPI.PendingSalesOrders Pending</span> *@
                    @*     </div> *@
                    @* } *@
                </div>
                <div class="col-auto">
                    <i class="fas fa-receipt fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="stats-card warning">
            <div class="row align-items-center">
                <div class="col">
                    <div class="h2 mb-1">@Model.KPI.TotalInventoryValue.ToString("C0")</div>
                    <div class="small">Inventory Value</div>
                    <div class="small mt-1">@Model.KPI.TotalItems.ToString("N0") Items</div>
                </div>
                <div class="col-auto">
                    <i class="fas fa-boxes fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="stats-card danger">
            <div class="row align-items-center">
                <div class="col">
                    <div class="h2 mb-1">@Model.KPI.TotalLocations.ToString("N0")</div>
                    <div class="small">Total Locations</div>
                    <div class="small mt-1">
                        <span class="@(Model.KPI.AverageCapacityUtilization > 80 ? "badge bg-danger" : Model.KPI.AverageCapacityUtilization > 60 ? "badge bg-warning" : "badge bg-success")">
                            @Model.KPI.AverageCapacityUtilization.ToString("F1")% Utilized
                        </span>
                    </div>
                </div>
                <div class="col-auto">
                    <i class="fas fa-warehouse fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
@if (Model.ShowKPICharts)
{
    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-line me-2"></i>
                        Order Trends
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="orderTrendChart" height="80"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-pie me-2"></i>
                        Stock Health
                    </h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <div class="h1 @Model.KPI.StockHealthScoreClass">
                            @Model.KPI.StockHealthScore.ToString("F1")%
                        </div>
                        <div class="text-muted">Health Score</div>
                    </div>
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="h4 text-success">@Model.KPI.ItemsInStock</div>
                            <div class="small text-muted">In Stock</div>
                        </div>
                        <div class="col-6">
                            <div class="h4 text-danger">@Model.KPI.OutOfStockItems</div>
                            <div class="small text-muted">Out of Stock</div>
                        </div>
                    </div>
                    @if (Model.KPI.LowStockItems > 0 || Model.KPI.CriticalStockItems > 0)
                    {
                        <div class="mt-3">
                            <div class="alert alert-warning py-2">
                                <small>
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    @Model.KPI.LowStockItems low stock, @Model.KPI.CriticalStockItems critical
                                </small>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
}

<!-- Main Content Row -->
<div class="row">
    <!-- Pending Actions -->
    @if (Model.ShowPendingActionsWidget && Model.PendingActions.HasPendingActions)
    {
        <div class="col-lg-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-tasks me-2"></i>
                        Pending Actions
                        <span class="badge bg-danger ms-2">@Model.PendingActions.TotalPendingActions</span>
                    </h5>
                </div>
                <div class="card-body p-0">
                    @foreach (var action in Model.PendingActions.GetPendingActionsList())
                    {
                        <div class="d-flex align-items-center p-3 border-bottom">
                            <div class="me-3">
                                <i class="@action.IconClass text-primary"></i>
                            </div>
                            <div class="flex-fill">
                                <div class="fw-medium">@action.Title</div>
                                <span class="@action.BadgeClass">@action.Count</span>
                            </div>
                            <div>
                                <a href="@action.ActionUrl" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    }

    <!-- Recent Activities -->
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-clock me-2"></i>
                    Recent Activities
                </h5>
            </div>
            <div class="card-body p-0">
                @if (Model.RecentActivities.Any())
                {
                    @foreach (var activity in Model.RecentActivities.Take(8))
                    {
                        <div class="d-flex align-items-center p-3 border-bottom">
                            <div class="me-3">
                                <i class="@activity.IconClass text-primary"></i>
                            </div>
                            <div class="flex-fill">
                                <div class="fw-medium">@activity.Title</div>
                                <div class="text-muted small">@activity.Description</div>
                                <div class="text-muted small">
                                    <i class="fas fa-user me-1"></i>@activity.CreatedBy
                                    <span class="ms-2">@activity.TimeAgo</span>
                                </div>
                            </div>
                            <div>
                                @if (!string.IsNullOrEmpty(activity.ReferenceNumber))
                                {
                                    <span class="@activity.BadgeClass">@activity.ReferenceNumber</span>
                                }
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="p-4 text-center text-muted">
                        <i class="fas fa-inbox fa-3x mb-3"></i>
                        <div>No recent activities</div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- System Alerts -->
@if (Model.ShowSystemAlerts && Model.SystemAlerts.Any())
{
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-bell me-2"></i>
                        System Alerts
                        <span class="badge bg-warning ms-2">@Model.AlertCount</span>
                    </h5>
                </div>
                <div class="card-body p-0">
                    @foreach (var alert in Model.SystemAlerts.Take(5))
                    {
                        <div class="alert @alert.LevelCssClass mb-0 border-0 border-bottom rounded-0" role="alert">
                            <div class="d-flex align-items-start">
                                <div class="me-3">
                                    <i class="@alert.IconClass"></i>
                                </div>
                                <div class="flex-fill">
                                    <div class="fw-bold">@alert.Title</div>
                                    <div class="mb-2">@alert.Message</div>
                                    <div class="small text-muted">
                                        <i class="fas fa-clock me-1"></i>@alert.CreatedDateDisplay
                                    </div>
                                </div>
                                @if (!string.IsNullOrEmpty(alert.ActionUrl))
                                {
                                    <div>
                                        <a href="@alert.ActionUrl" class="btn btn-sm btn-outline-primary">
                                            @alert.ActionText
                                        </a>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
}

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-rocket me-2"></i>
                    Quick Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-3 col-md-6 mb-3">
                        <a href="/PurchaseOrder/Create" class="btn btn-outline-primary w-100 h-100 d-flex flex-column justify-content-center align-items-center py-3">
                            <i class="fas fa-plus-circle fa-2x mb-2"></i>
                            <div>Create Purchase Order</div>
                        </a>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <a href="/ASN/Create" class="btn btn-outline-success w-100 h-100 d-flex flex-column justify-content-center align-items-center py-3">
                            <i class="fas fa-truck fa-2x mb-2"></i>
                            <div>Create ASN</div>
                        </a>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <a href="/SalesOrder/Create" class="btn btn-outline-info w-100 h-100 d-flex flex-column justify-content-center align-items-center py-3">
                            <i class="fas fa-receipt fa-2x mb-2"></i>
                            <div>Create Sales Order</div>
                        </a>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <a href="/Inventory/Putaway" class="btn btn-outline-warning w-100 h-100 d-flex flex-column justify-content-center align-items-center py-3">
                            <i class="fas fa-boxes fa-2x mb-2"></i>
                            <div>Putaway Items</div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer Info -->
<div class="row">
    <div class="col-12">
        <div class="text-center text-muted small">
            <i class="fas fa-sync-alt me-1"></i>
            Last updated: @Model.LastRefreshDisplay
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Order Trend Chart
            const orderTrendCtx = document.getElementById('orderTrendChart');
            if (orderTrendCtx) {
                new Chart(orderTrendCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Purchase Orders',
                            data: [12, 19, 8, 15, 22, 18],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Sales Orders',
                            data: [8, 15, 12, 20, 18, 25],
                            borderColor: '#059669',
                            backgroundColor: 'rgba(5, 150, 105, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0,0,0,0.1)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0,0,0,0.1)'
                                }
                            }
                        }
                    }
                });
            }

            // Auto refresh notification
            setInterval(function() {
                const refreshTime = document.querySelector('.text-muted.small');
                if (refreshTime) {
                    const now = new Date();
                    refreshTime.innerHTML = '<i class="fas fa-sync-alt me-1"></i>Last updated: ' + now.toLocaleString('id-ID');
                }
            }, 60000); // Update every minute
        });
    </script>
}