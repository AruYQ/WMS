@{
    ViewData["Title"] = "Location Management";
}

<div id="locationManagerApp">
    <!-- Header -->
<div class="page-header">
    <div class="row align-items-center">
        <div class="col">
            <h1 class="page-title">
                <i class="fas fa-map-marker-alt me-2"></i>
                Location Management
            </h1>
                <p class="page-subtitle">Manage warehouse locations with real-time updates</p>
        </div>
        <div class="col-auto">
                <button type="button" class="btn btn-primary" onclick="openCreateModal()">
                    <i class="fas fa-plus"></i> Add Location
                </button>
            </div>
    </div>
</div>

    <!-- Statistics Dashboard -->
    <div class="row mb-4" id="statisticsCards">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-map-marker-alt fa-2x"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                            <h4 class="mb-0" id="totalLocations">0</h4>
                        <small>Total Locations</small>
                        </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                            <h4 class="mb-0" id="activeLocations">0</h4>
                        <small>Active Locations</small>
                        </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                            <h4 class="mb-0" id="nearFullLocations">0</h4>
                        <small>Near Full (≥80%)</small>
                        </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-times-circle fa-2x"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                            <h4 class="mb-0" id="fullLocations">0</h4>
                        <small>Full Locations</small>
                        </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Filters & Search -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <select id="statusFilter" class="form-select">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="full">Full</option>
                        <option value="near-full">Near Full (≥80%)</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select id="capacityFilter" class="form-select">
                        <option value="">All Capacity</option>
                        <option value="empty">Empty (0%)</option>
                        <option value="low">Low (1-50%)</option>
                        <option value="medium">Medium (51-79%)</option>
                        <option value="high">High (80-99%)</option>
                        <option value="full">Full (100%)</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search by code or name...">
                    </div>
                <div class="col-md-2">
                    <button type="button" id="refreshBtn" class="btn btn-outline-primary w-100">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
            </div>
        </div>
    </div>
</div>

    <!-- Data Table -->
<div class="card">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
                <i class="fas fa-list me-2"></i>
                Location List
            </h5>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="refreshCapacities()">
                        <i class="fas fa-sync-alt me-1"></i>
                        Refresh Capacities
                    </button>
                    <div class="btn-group">
                        <button type="button" class="btn btn-outline-info btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-download me-1"></i>
                            Export
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="exportLocations()">
                                <i class="fas fa-file-csv text-info me-2"></i>Export to CSV
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="openExportModal()">
                                <i class="fas fa-file-excel text-success me-2"></i>Export to Excel
                            </a></li>
                        </ul>
                    </div>
                </div>
            </div>
    </div>
    <div class="card-body p-0">
            <div class="table-responsive">
                <table id="locationsTable" class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Capacity</th>
                            <th>Status</th>
                            <th>Utilization</th>
                            <th>Last Updated</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="locationsTableBody">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
            <div id="noLocationsMessage" class="text-center py-5" style="display: none;">
                <i class="fas fa-map-marker-alt fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">No Locations Found</h5>
                <p class="text-muted">Get started by adding your first warehouse location.</p>
                <button type="button" class="btn btn-primary" onclick="openCreateModal()">
                    <i class="fas fa-plus me-1"></i>
                    Add First Location
                </button>
            </div>
        </div>
        
        <!-- Pagination Controls -->
        <div class="card-footer bg-light">
            <div class="d-flex justify-content-between align-items-center">
                <!-- Pagination Info -->
                <div class="pagination-info">
                    <span id="paginationInfo" class="text-muted">
                        Showing <span id="showingStart">0</span> to <span id="showingEnd">0</span> of <span id="totalRecords">0</span> locations
                    </span>
                </div>
                
                <!-- Page Size Selector -->
                <div class="d-flex align-items-center">
                    <label for="pageSizeSelect" class="form-label me-2 mb-0 small">Show:</label>
                    <select id="pageSizeSelect" class="form-select form-select-sm" style="width: auto;">
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="ms-2 small text-muted">per page</span>
                </div>
            </div>
            
            <!-- Pagination Navigation -->
            <div class="d-flex justify-content-center mt-3">
                <nav aria-label="Location pagination">
                    <ul id="paginationNav" class="pagination pagination-sm mb-0">
                        <!-- Dynamic pagination buttons -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Modal -->
<div class="modal fade" id="locationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Create Location</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="locationForm">
                    <input type="hidden" id="locationId" name="Id">
                    <div id="formErrors" class="alert alert-danger d-none" role="alert"></div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="code" class="form-label">Code <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="code" name="Code" placeholder="e.g., A-01-01" required>
                                <div class="form-text">Format: [Area]-[Rack]-[Slot] (e.g., A-01-01, B-02-03)</div>
                                <div id="codeValidation" class="form-text"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="Name" placeholder="e.g., Zone A Rack 1 Slot 1" required>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="Description" rows="3" placeholder="Optional description of the location..."></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="maxCapacity" class="form-label">Max Capacity <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="maxCapacity" name="MaxCapacity" min="1" placeholder="e.g., 100" required>
                                <div class="form-text">Maximum number of units this location can hold</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="form-check form-switch mt-4">
                                    <input class="form-check-input" type="checkbox" id="isActive" name="IsActive" checked>
                                    <label class="form-check-label" for="isActive">Active</label>
                                </div>
                                <div class="form-text">Inactive locations cannot be used for inventory storage</div>
                            </div>
                        </div>
                    </div>

                    <!-- Current Status (Edit Mode Only) -->
                    <div id="currentStatus" class="alert alert-info d-none">
                        <h6><i class="fas fa-info-circle me-1"></i> Current Status</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <small>Current Usage: <strong id="currentCapacity">0</strong> / <strong id="currentMaxCapacity">0</strong> units</small>
                            </div>
                            <div class="col-md-6">
                                <small>Utilization: <strong id="currentUtilization">0%</strong></small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveLocationBtn" onclick="saveLocation()">
                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                    <i class="fas fa-save me-1"></i>
                    Save Location
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Details Modal -->
<div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    Location Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="locationDetails">
                    <!-- Dynamic content -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="editLocationFromDetails()">
                    <i class="fas fa-edit me-1"></i>
                    Edit Location
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                    Confirm Delete
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this location?</p>
                <div class="alert alert-warning">
                    <i class="fas fa-info-circle me-1"></i>
                    This action cannot be undone. If this location has inventory, it will be moved to default location.
                </div>
                <div id="deleteLocationInfo">
                    <!-- Location info -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" onclick="confirmDeleteLocation()">
                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                    <i class="fas fa-trash me-1"></i>
                    Delete Location
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="successToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-success text-white">
            <i class="fas fa-check-circle me-2"></i>
            <strong class="me-auto">Success</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="successMessage">
            <!-- Success message -->
        </div>
    </div>
    
    <div id="errorToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-danger text-white">
            <i class="fas fa-exclamation-circle me-2"></i>
            <strong class="me-auto">Error</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="errorMessage">
            <!-- Error message -->
        </div>
    </div>
</div>

<!-- Export Excel Modal -->
<div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exportModalLabel">
                    <i class="fas fa-file-excel text-success me-2"></i>Export to Excel
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="exportForm">
                    <div class="row">
                        <!-- Date Range Filters -->
                        <div class="col-md-6 mb-3">
                            <label for="exportDateFrom" class="form-label">Date From</label>
                            <input type="date" class="form-control" id="exportDateFrom" name="dateFrom">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="exportDateTo" class="form-label">Date To</label>
                            <input type="date" class="form-control" id="exportDateTo" name="dateTo">
                        </div>
                    </div>

                    <div class="row">
                        <!-- Status Filter -->
                        <div class="col-md-6 mb-3">
                            <label for="exportStatusFilter" class="form-label">Status Filter</label>
                            <select class="form-select" id="exportStatusFilter" name="statusFilter">
                                <option value="">All Status</option>
                                <option value="active">Active Only</option>
                                <option value="inactive">Inactive Only</option>
                                <option value="full">Full Locations</option>
                                <option value="empty">Empty Locations</option>
                            </select>
                        </div>

                        <!-- Location Type Filter -->
                        <div class="col-md-6 mb-3">
                            <label for="exportLocationTypeFilter" class="form-label">Location Type</label>
                            <select class="form-select" id="exportLocationTypeFilter" name="locationTypeFilter">
                                <option value="">All Types</option>
                                <option value="storage">Storage Locations</option>
                                <option value="special">Special Areas</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Capacity Range -->
                        <div class="col-md-6 mb-3">
                            <label for="exportCapacityFrom" class="form-label">Min Capacity</label>
                            <input type="number" class="form-control" id="exportCapacityFrom" name="capacityFrom" min="0" placeholder="e.g., 100">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="exportCapacityTo" class="form-label">Max Capacity</label>
                            <input type="number" class="form-control" id="exportCapacityTo" name="capacityTo" min="0" placeholder="e.g., 500">
                        </div>
                    </div>

                    <!-- Search Text -->
                    <div class="mb-3">
                        <label for="exportSearchText" class="form-label">Search Text</label>
                        <input type="text" class="form-control" id="exportSearchText" name="searchText" placeholder="Search in Code, Name, or Description">
                    </div>

                    <!-- Export Info -->
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Export Features:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Professional Excel format (.xlsx) with multiple sheets</li>
                            <li>Summary sheet with statistics and charts</li>
                            <li>Detailed location data with conditional formatting</li>
                            <li>Capacity utilization analysis</li>
                        </ul>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="exportExcelBtn" onclick="exportToExcel()">
                    <i class="fas fa-file-excel me-1"></i>Export to Excel
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/location-manager.js"></script>
}